<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fairblock Web3 Encoder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/index.umd.min.js"></script>
    <style>
        body { background-color: #0d0221; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: 'Segoe UI', sans-serif; color: white; }
        .container { background-color: #0d0221; width: 420px; padding: 40px; border-radius: 45px; border: 1px solid #1a1a3a; box-shadow: 0 0 60px rgba(0,0,0,0.7); text-align: center; }
        h1 { color: #00fff2; letter-spacing: 6px; margin: 0; font-size: 34px; text-shadow: 0 0 10px rgba(0,255,242,0.3); }
        .subtitle { color: #4a4a6a; font-size: 11px; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 2px; }
        
        .wallet-status { color: #555; font-size: 11px; margin-bottom: 20px; cursor: pointer; padding: 12px; border-radius: 15px; border: 1px solid #1a1a3a; transition: 0.3s; background: rgba(255,255,255,0.02); }
        .wallet-status.connected { color: #00ff88; border-color: #004422; background: rgba(0,255,136,0.05); }
        .wallet-status:hover { background: rgba(255,255,255,0.05); }

        .timer-badge { background: rgba(0, 255, 136, 0.03); color: #00ff88; border: 1px solid #004422; padding: 10px 25px; border-radius: 25px; font-family: monospace; display: inline-block; margin-bottom: 25px; font-size: 14px; }
        
        textarea { width: 100%; height: 120px; background: rgba(0,0,0,0.2); border: 2px solid #00ff88; border-radius: 22px; color: #fff; padding: 20px; box-sizing: border-box; outline: none; resize: none; font-size: 14px; transition: 0.3s; }
        textarea:focus { box-shadow: 0 0 15px rgba(0,255,136,0.1); }
        
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin: 25px 0; }
        button { width: 100%; padding: 16px; border-radius: 18px; border: none; background: #1a1a35; color: #fff; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 13px; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button:hover { background: #252545; transform: translateY(-1px); }
        button:active { transform: translateY(1px); }
        button.primary { background: #00ff88; color: #0d0221; box-shadow: 0 4px 15px rgba(0,255,136,0.2); }
        button:disabled { opacity: 0.4; cursor: not-allowed; }
        
        .result-area { border: 1px dashed #2a2a4a; border-radius: 25px; padding: 20px; min-height: 80px; display: flex; flex-direction: column; justify-content: center; background: rgba(0,0,0,0.1); }
        #output { color: #00ff88; word-break: break-all; font-family: monospace; font-size: 11px; line-height: 1.4; }
        .tx-link { color: #55aaff; text-decoration: underline; font-size: 10px; margin-top: 10px; display: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>FAIRBLOCK</h1>
    <div class="subtitle">Secure Message Encoder</div>
    
    <div class="wallet-status" id="walletAddr" onclick="connectWallet()">‚óè –ü–û–î–ö–õ–Æ–ß–ò–¢–¨ –ö–û–®–ï–õ–ï–ö (RABBY/METAMASK)</div>

    <div class="timer-badge" id="clock">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</div>

    <textarea id="input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>

    <div class="btn-group">
        <button class="primary" id="btnEncode" onclick="handleTransaction('–ó–ê–®–ò–§–†–û–í–ê–¢–¨')">üîí –ó–ê–®–ò–§–†–û–í–ê–¢–¨ –í –ë–õ–û–ö–ß–ï–ô–ù</button>
        <button id="btnDecode" onclick="handleTransaction('–í–°–ö–†–´–¢–¨')">üîì –í–°–ö–†–´–¢–¨ –®–ò–§–†</button>
    </div>

    <div class="result-area">
        <div id="output">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
        <a id="txLink" class="tx-link" target="_blank">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ Explorer ‚Üó</a>
    </div>
</div>

<script>
    let signer = null;
    const SEPOLIA_HEX = "0xaa36a7"; 

    // 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ)
    function updateClock() {
        const now = new Date();
        const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('clock').innerText = now.toLocaleString('ru-RU', options);
    }
    setInterval(updateClock, 1000);
    updateClock();

    // 2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (Rabby –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ)
    async function connectWallet() {
        if (!window.ethereum) return alert("–ö–æ—à–µ–ª–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Rabby –∏–ª–∏ MetaMask.");
        
        try {
            // –ï—Å–ª–∏ –µ—Å—Ç—å Rabby –∏ MetaMask, –≤—ã–±–∏—Ä–∞–µ–º Rabby –∏–ª–∏ —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π
            const provider = window.ethereum.providers ? 
                             (window.ethereum.providers.find(p => p.isRabby) || window.ethereum.providers[0]) : 
                             window.ethereum;

            const browserProvider = new ethers.BrowserProvider(provider);
            
            // –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É —Å–µ—Ç–∏ –Ω–∞ Sepolia
            try {
                await provider.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: SEPOLIA_HEX }],
                });
            } catch (e) {
                if (e.code === 4902) alert("–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ç—å Sepolia –≤ –∫–æ—à–µ–ª–µ–∫");
            }

            signer = await browserProvider.getSigner();
            const addr = await signer.getAddress();
            
            const walletName = provider.isRabby ? "RABBY" : "WEB3";
            const statusEl = document.getElementById('walletAddr');
            statusEl.innerText = `‚óè ${walletName}: ${addr.substring(0, 6)}...${addr.substring(38)}`;
            statusEl.classList.add('connected');
            document.getElementById('output').innerText = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –ú–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å.";
        } catch (err) {
            alert("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " + err.message);
        }
    }

    // 3. –õ–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ / –í—Å–∫—Ä—ã—Ç–∏–µ)
    async function handleTransaction(actionType) {
        if (!signer) {
            await connectWallet();
            if (!signer) return;
        }
        
        const text = document.getElementById('input').value;
        if (!text) return alert("–ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—É—Å—Ç–æ!");

        const out = document.getElementById('output');
        const link = document.getElementById('txLink');
        
        try {
            document.querySelectorAll('button').forEach(b => b.disabled = true);
            out.innerText = `[${actionType}] –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –≤ –∫–æ—à–µ–ª—å–∫–µ...`;
            
            // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –≤ HEX-–¥–∞—Ç—É –¥–ª—è –±–ª–æ–∫—á–µ–π–Ω–∞
            const hexData = ethers.hexlify(ethers.toUtf8Bytes(`${actionType}: ${text}`));

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å–∞–º–æ–º—É —Å–µ–±–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ Input Data)
            const tx = await signer.sendTransaction({
                to: await signer.getAddress(),
                data: hexData,
                value: 0
            });

            out.innerText = "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–µ—Ç—å—é...";
            link.style.display = "block";
            link.href = `https://sepolia.etherscan.io/tx/${tx.hash}`;
            
            await tx.wait();
            out.innerText = `–£–°–ü–ï–•! –î–µ–π—Å—Ç–≤–∏–µ [${actionType}] –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ.`;
        } catch (err) {
            out.innerText = "–û—à–∏–±–∫–∞: " + (err.reason || "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞");
            link.style.display = "none";
        } finally {
            document.querySelectorAll('button').forEach(b => b.disabled = false);
        }
    }
</script>

</body>
</html>